
f15 <-c("209683_at","200779_at","203657_s_at","201425_at","217752_s_at","200783_s_at",
        "202486_at","202951_at","208644_at","202470_s_at","212098_at","228737_at",
        "204072_s_at","228677_s_at","1565162_s_at","231736_x_at")

f70 <- c("202345_s_at","1555864_s_at","204033_at","206513_at","1555274_a_at","211576_s_at",
         "204016_at","1565951_s_at","219918_s_at","201947_s_at","213535_s_at","204092_s_at",
         "213607_x_at","208117_s_at","210334_x_at","204023_at","201897_s_at","216194_s_at",
         "225834_at","238952_x_at","200634_at","208931_s_at","206332_s_at","220789_s_at",
         "218947_s_at","213310_at","224523_s_at","201231_s_at","217901_at","226936_at",
         "58696_at","200916_at","201614_s_at","200966_x_at","225082_at","242488_at","243011_at",
         "201105_at","224200_s_at","222417_s_at","210460_s_at","200750_s_at","206364_at",
         "201091_s_at","203432_at","221970_s_at","212533_at","213194_at","244686_at",
         "200638_s_at","205235_s_at", "201921_at","227278_at","209740_s_at","227547_at","225582_at","200850_s_at","213628_at",
         "209717_at","222495_at","1557277_a_at","1554736_at","218924_s_at","226954_at",
         "202838_at","230192_at","48106_at","237964_at","202729_s_at","212435_at")

f92 <- c('204379_s_at','202728_s_at','239054_at','202842_s_at','213002_at',
         '210334_x_at','201795_at','38158_at','208232_x_at','201307_at','226742_at',
         '205046_at','204026_s_at','226218_at','217824_at','233399_x_at','224009_x_at',
         '215177_s_at','202532_s_at','238662_at','212788_x_at','220351_at','202542_s_at',
         '243018_at','209683_at','212282_at','208967_s_at','225366_at','217852_s_at',
         '225601_at','231210_at','214482_at','208942_s_at','219550_at','231989_s_at',
         '202553_s_at','223811_s_at','221041_s_at','221677_s_at','213350_at','200775_s_at',
         '226217_at','217728_at','201930_at','216473_x_at','211714_x_at','221755_at',
         'AFFX-HUMISGF3A/M97935_MA_at','206204_at','217548_at','215181_at','217732_s_at',
         '214612_x_at','202813_at','200875_s_at','201292_at','222680_s_at','233437_at',
         '223381_at','209026_x_at','221606_s_at','231738_at','230034_x_at','213007_at',
         '242180_at','202322_s_at','208904_s_at','214150_x_at','238116_at','208732_at',
         '200701_at','208667_s_at','208747_s_at','218662_s_at','211963_s_at','201555_at',
         '207618_s_at','200933_x_at','221826_at','218355_at','219510_at','218365_s_at',
         '222713_s_at','222154_s_at','228416_at','201102_s_at','203145_at','238780_s_at',
         '202884_s_at','201398_s_at','212055_at','202107_s_at')

f80 <-  c("202768_at","230292_at","217513_at","1564423_a_at","211302_s_at","233909_at",
          "215671_at","208869_s_at","1552542_s_at","1561060_at","1557633_at","223961_s_at",
          "202340_x_at","226499_at","242548_x_at","228984_at","229388_at","1552519_at",
          "239343_at","212960_at","236986_at","223643_at","203708_at","221223_x_at",
          "213658_at","238801_at","235670_at","225582_at","227524_at","239082_at",
          "223377_x_at","216215_s_at","212050_at","200673_at","223250_at","227893_at",
          "223215_s_at","226399_at", "201754_at","219110_at","201652_at","200642_at","209251_x_at","200014_s_at",
          "200039_s_at","201252_at","226924_at","225638_at","235346_at","211069_s_at",
          "202244_at","201400_at","202596_at","202243_s_at","218351_at","223480_s_at",
          "209503_s_at","212626_x_at","203396_at","200882_s_at","201157_s_at","200786_at",
          "209628_at","204587_at","210460_s_at","200830_at","202690_s_at","211609_x_at",
          "218566_s_at","212296_at","217933_s_at","201114_x_at","205687_at","210334_x_at",
          "229417_at","238996_x_at","236554_x_at","229856_s_at","214752_x_at","208576_s_at")

f17 <-  c("200638_s_at","1557277_a_at","200850_s_at","201897_s_at","202729_s_at","203432_at",
          "204016_at","205235_s_at","206364_at","206513_at","211576_s_at","213607_x_at",
          "213628_at","218924_s_at","219918_s_at","220789_s_at","242488_at")

f100 <-  c("204944_at","210394_x_at","225105_at","204430_s_at","227126_at",
           "221601_s_at","206626_x_at","211425_x_at","210497_x_at","211674_x_at",
           "218695_at","216471_x_at","203828_s_at","226219_at","232231_at",
           "225548_at","205718_at","221602_s_at","220565_at","209942_x_at",
           "218529_at","207666_x_at","212281_s_at","223743_s_at","241224_x_at",
           "225213_at","223625_at","227212_s_at","214612_x_at","212680_x_at",
           "224579_at","225400_at","218826_at","206640_x_at","229826_at",
           "212750_at","220448_at","208416_s_at","205592_at","223670_s_at",
           "210746_s_at","201131_s_at","227654_at","211820_x_at","205838_at",
           "208335_s_at","209930_s_at","209301_at","215811_at","205268_s_at",
           "232232_s_at","223669_at","202219_at","205950_s_at","205837_s_at",
           "211821_x_at","210395_x_at","219672_at","206488_s_at","215819_s_at",
           "205671_s_at","210504_at","216054_x_at","236981_at","226751_at",
           "235916_at","204249_s_at","205033_s_at","206937_at","242197_x_at",
           "210036_s_at","210215_at","208352_x_at","210986_s_at","217865_at",
           "37986_at","200934_at","210430_x_at","214464_at","206093_x_at","203662_s_at",
           "210586_x_at","209555_s_at","215449_at","202201_at","206283_s_at","221627_at",
           "206145_at","206077_at","205390_s_at","205391_x_at","208886_at","237403_at",
           "225061_at","216333_x_at","208353_x_at","213451_x_at","207087_x_at","209160_at","205262_at")

f6 <- c("203755_at", "203213_at", "200608_s_at", "216326_s_at", "218034_at", 
         "217731_s_at")

meanvarstandardize<-function(testdata, traindata = ""){
  
  if ("matrix" %in% class(traindata)){traindata=testdata}
  
  inters <- intersect(colnames(traindata),colnames(testdata))
  trainmean <- colMeans(traindata[,inters])
  trainsd <- apply(traindata[,inters], 2, sd)
  
  testdata <- t(t(testdata[,inters]) - trainmean)
  testdata <- t(t(testdata)/trainsd)
  return(testdata)
}


EMC92Classifier<-function(testlogdata, trainlogdata,threshold=NULL){
  
  if (is.null(threshold)){threshold=0.827;}
  EMCScore<-c(0.0594273379801556,-0.110491572253885,-0.108832301005201,-0.062550086484268,-0.0418164824703641,0.0174897923948543,0.00668584689209701,0.0423154071076169,-0.0493203905211073,0.0164925076573208,-0.0344544706411548,0.00866233731636807,0.00455819600852017,-0.0644105573058562,-0.00414107711721288,-0.0183994540236258,-0.0520135932088583,-0.0767532974279582,-0.00063407777663618,0.0489558593887832,-0.0163691988848842,0.0420452994583269,0.0870276088358123,0.0406887458334764,-0.05606504920594,0.0529972408575157,0.0112796922615379,0.0140109440864371,0.00078080860374577,0.075000229909631,0.009265826714752,0.0860546977563988,-0.0996944005531858,0.0558748936987772,0.073011096187736,0.00538232634785429,0.055611094941233,-0.0520445402963303,0.0125985686829356,0.005608194716564,0.0163467078063,-0.0319185908460475,0.0773361612870129,-0.00900009551662273,-0.0575829465263513,0.022119958576764,0.0396248830654306,0.0524561174360331,0.0476703103071683,-0.0422745546301539,-0.0341783399437912,-0.0251675596648738,0.0495596844465701,0.0547508890118559,0.0437224907573062,-0.0371869820707693,0.0205354349665636,0.0445923111233813,-0.0069962048640006,0.025498590737044,0.0208131193381807,0.0685640666167821,-0.0330380997958823,-0.0105781969037762,-0.0585102612125953,0.0128945938676131,-0.0333628118834898,-0.0349253487676344,0.0660971817524709,-0.0617575340318364,-0.0210452256979565,-0.0389953930227488,-0.0873912090180467,-0.0176248165093743,0.0302900524131141,-0.0051520032747514,0.0745893468079515,-0.0322581999457566,0.0200333568025016,0.0115861932788841,-0.00969926642147875,0.00345861530256628,0.0277930303183715,0.0153863421114279,-0.0777964537268526,0.0349480953839344,-0.00022873908620183,-0.0529393125922244,0.0713507977617356,-0.0253569213540041,0.0384170565171902,0.0225490655109955)
  names(EMCScore)<-c('204379_s_at','202728_s_at','239054_at','202842_s_at','213002_at','210334_x_at','201795_at','38158_at','208232_x_at','201307_at','226742_at','205046_at','204026_s_at','226218_at','217824_at','233399_x_at','224009_x_at','215177_s_at','202532_s_at','238662_at','212788_x_at','220351_at','202542_s_at','243018_at','209683_at','212282_at','208967_s_at','225366_at','217852_s_at','225601_at','231210_at','214482_at','208942_s_at','219550_at','231989_s_at','202553_s_at','223811_s_at','221041_s_at','221677_s_at','213350_at','200775_s_at','226217_at','217728_at','201930_at','216473_x_at','211714_x_at','221755_at','AFFX-HUMISGF3A/M97935_MA_at','206204_at','217548_at','215181_at','217732_s_at','214612_x_at','202813_at','200875_s_at','201292_at','222680_s_at','233437_at','223381_at','209026_x_at','221606_s_at','231738_at','230034_x_at','213007_at','242180_at','202322_s_at','208904_s_at','214150_x_at','238116_at','208732_at','200701_at','208667_s_at','208747_s_at','218662_s_at','211963_s_at','201555_at','207618_s_at','200933_x_at','221826_at','218355_at','219510_at','218365_s_at','222713_s_at','222154_s_at','228416_at','201102_s_at','203145_at','238780_s_at','202884_s_at','201398_s_at','212055_at','202107_s_at')
  testlogdata<-t(testlogdata);
  trainlogdata<-t(trainlogdata);
  inters<-intersect(colnames(testlogdata),names(EMCScore))
  if(length(inters)<length(EMCScore)){warning("Not all EMC92 genes in dataset!")}
  testlogdata <- testlogdata[,intersect(colnames(testlogdata),names(EMCScore))]
  
  testlogdata<-meanvarstandardize(testdata = testlogdata,
                                  traindata = trainlogdata)
  score<-testlogdata%*%EMCScore[colnames(testlogdata)]
  return(matrix(cbind(score,score>threshold),ncol=2,
                dimnames=list(rownames(testlogdata),c("score","isHighRisk"))))
}

MRCIX6Classifier <- function(testlogdata, threshold = NULL){
  
  if (is.null(threshold)){
    threshold=0.999999
  }
  BUB1B<-c("203755_at")
  CDK1<-c("203213_at");#c("210559_s_at","203214_x_at","203213_at","231534_at")#according to patent
  RAD21<-c("200608_s_at")#c("200607_s_at","200608_s_at") #according to patent
  HDAC3<-c("216326_s_at")
  FIS1<-c("218034_at")
  ITM2B<-c("217731_s_at");#c("217732_s_at","217731_s_at")#Has best similarity to dickens paper
  
  #Make sure the apply function keeps working...
  CDK1 <- c(CDK1,CDK1);
  RAD21 <- c(RAD21,RAD21);
  ITM2B <- c(ITM2B,ITM2B);	
  r1 <- r2 <- r3 <- 0;
  testlogdata <- t(testlogdata)
  BUB1B <- intersect(colnames(testlogdata), BUB1B)
  RAD21 <- intersect(colnames(testlogdata), RAD21)
  HDAC3 <- intersect(colnames(testlogdata), HDAC3)
  ITM2B <- intersect(colnames(testlogdata), ITM2B)
  CDK1  <- intersect(colnames(testlogdata), CDK1)
  FIS1  <- intersect(colnames(testlogdata), FIS1)
  if(length(c(BUB1B,RAD21,HDAC3,ITM2B,CDK1,FIS1)) != 11){
    dowarn<-1
  }
  
  if( (length(BUB1B)>0) & (length(HDAC3)>0)){
    r1<-r1+testlogdata[,BUB1B]/testlogdata[,HDAC3]
  }
  
  if( (length(CDK1)>0) & (length(FIS1)>0)){
    r2<-testlogdata[,CDK1]/testlogdata[,FIS1]
  }
  if( (length(RAD21)>0) & (length(ITM2B)>0)){
    r3<-testlogdata[,RAD21]/testlogdata[,ITM2B]
  }
  
  score <- (r1 > 1) + ( r2 > 1 ) + (r3 > 1)
  return(matrix(cbind(score, score > threshold), ncol = 2,
                dimnames=list(rownames(testlogdata), c("score", "isHighRisk"))))
}


UAMS80Classifier<-function(testlogdata,threshold=NULL){
  
  #Pharmacogenomics of bortezomib test-dosing identifies hyperexpression of proteasome gene, especially... shaughnessy et al, Blood, doi:10.1182/blood-2010-12-328252
  if (is.null(threshold)){ threshold = 2.48}
  goodprobes <- 
    c("202768_at","230292_at","217513_at","1564423_a_at","211302_s_at","233909_at",
      "215671_at","208869_s_at","1552542_s_at","1561060_at","1557633_at","223961_s_at",
      "202340_x_at","226499_at","242548_x_at","228984_at","229388_at","1552519_at",
      "239343_at","212960_at","236986_at","223643_at","203708_at","221223_x_at",
      "213658_at","238801_at","235670_at","225582_at","227524_at","239082_at",
      "223377_x_at","216215_s_at","212050_at","200673_at","223250_at","227893_at",
      "223215_s_at","226399_at")
  
  badprobes <- 
    c("201754_at","219110_at","201652_at","200642_at","209251_x_at","200014_s_at",
      "200039_s_at","201252_at","226924_at","225638_at","235346_at","211069_s_at",
      "202244_at","201400_at","202596_at","202243_s_at","218351_at","223480_s_at",
      "209503_s_at","212626_x_at","203396_at","200882_s_at","201157_s_at","200786_at",
      "209628_at","204587_at","210460_s_at","200830_at","202690_s_at","211609_x_at",
      "218566_s_at","212296_at","217933_s_at","201114_x_at","205687_at","210334_x_at",
      "229417_at","238996_x_at","236554_x_at","229856_s_at","214752_x_at","208576_s_at")
  
  testlogdata <- t(testlogdata);
  intersgood <- intersect(colnames(testlogdata),goodprobes)
  intersbad  <- intersect(colnames(testlogdata),badprobes)
  if(length(c(intersgood,intersbad))<length(c(goodprobes,badprobes))){
    warning("Not all UAMS80 genes in dataset!")
  }
  testlogdata <- testlogdata[,c(intersgood,intersbad)]
  score <- rowMeans(testlogdata[,intersbad])-rowMeans(testlogdata[,intersgood])
  return(matrix(cbind(score,score>threshold),ncol=2,
                dimnames = list(rownames(testlogdata), c("score","isHighRisk"))))
}

UAMS17Classifier <- function(testlogdata, trainlogdata, threshold = NULL){
  
  # The corrected UAMS17 gene signature as described in W.J. Chng, W.M. Kuehl, P.L. Bergsagel, and R. Fonseca, Translocation t(4;14) retains 	
  # prognostic significance even in the setting of high-risk molecular signature,Leukemia,  vol. 22, 2008, pp. 462-462.
  if (is.null(threshold)){
    threshold = 1.5
  }
  
  UAMS17score <- 
    c(0.283,-0.296,-0.208,+0.314,-0.287,+0.251,+0.193,+0.269,+0.375,+0.158,+0.316,
      +0.232,-0.251,-0.23,-0.402,+0.191,+0.148)
  
  names(UAMS17score) <- 
    c("200638_s_at","1557277_a_at","200850_s_at","201897_s_at","202729_s_at","203432_at",
      "204016_at","205235_s_at","206364_at","206513_at","211576_s_at","213607_x_at",
      "213628_at","218924_s_at","219918_s_at","220789_s_at","242488_at")
  
  testlogdata  <-t(testlogdata);
  trainlogdata <-t(trainlogdata);
  inters <- intersect(colnames(testlogdata), names(UAMS17score))
  if(length(inters) < length(UAMS17score)){
    warning("Not all UAMS genes in dataset!")
  }
  
  testlogdata <- testlogdata[,intersect(colnames(testlogdata),names(UAMS17score))]
  testlogdata <- meanvarstandardize(testdata=testlogdata,traindata=trainlogdata)
  score <- testlogdata%*%UAMS17score[colnames(testlogdata)]
  return(matrix(cbind(score,score>threshold),ncol=2,
                dimnames=list(rownames(testlogdata),c("score","isHighRisk"))))
}

MILLENNIUM100Classifier <- function(testlogdata, trainlogdata, threshold = NULL){
  
  if (is.null(threshold)){
    threshold=0.55
  }
  
  MullScore <- 
    c(3.05,2.96,2.94,2.9,2.87,2.85,2.82,2.8,2.76,2.66,2.63,2.61,2.58,2.57,2.55,
      2.52,2.52,2.51,2.5,2.48,2.47,2.46,2.45,2.45,2.42,2.4,2.39,2.37,2.34,2.34,
      2.33,2.33,2.32,2.32,2.31,2.29,2.28,-2.29,-2.3,-2.3,-2.35,-2.35,-2.35,-2.36,
      -2.36,-2.37,-2.37,-2.37,-2.38,-2.38,-2.39,-2.39,-2.4,-2.4,-2.42,-2.42,-2.43,
      -2.44,-2.47,-2.47,-2.47,-2.48,-2.49,-2.49,-2.5,-2.52,-2.52,-2.53,-2.53,-2.54,
      -2.55,-2.55,-2.56,-2.57,-2.57,-2.61,-2.61,-2.61,-2.62,-2.64,-2.65,-2.67,-2.68,
      -2.69,-2.69,-2.69,-2.7,-2.72,-2.74,-2.77,-2.78,-2.79,-2.82,-2.88,-2.88,-2.91,
      -2.96,-2.97,-3.07,-3.22)
  
  names(MullScore) <- 
    c("204944_at","210394_x_at","225105_at","204430_s_at","227126_at",
      "221601_s_at","206626_x_at","211425_x_at","210497_x_at","211674_x_at",
      "218695_at","216471_x_at","203828_s_at","226219_at","232231_at",
      "225548_at","205718_at","221602_s_at","220565_at","209942_x_at",
      "218529_at","207666_x_at","212281_s_at","223743_s_at","241224_x_at",
      "225213_at","223625_at","227212_s_at","214612_x_at","212680_x_at",
      "224579_at","225400_at","218826_at","206640_x_at","229826_at",
      "212750_at","220448_at","208416_s_at","205592_at","223670_s_at",
      "210746_s_at","201131_s_at","227654_at","211820_x_at","205838_at",
      "208335_s_at","209930_s_at","209301_at","215811_at","205268_s_at",
      "232232_s_at","223669_at","202219_at","205950_s_at","205837_s_at",
      "211821_x_at","210395_x_at","219672_at","206488_s_at","215819_s_at",
      "205671_s_at","210504_at","216054_x_at","236981_at","226751_at",
      "235916_at","204249_s_at","205033_s_at","206937_at","242197_x_at",
      "210036_s_at","210215_at","208352_x_at","210986_s_at","217865_at",
      "37986_at","200934_at","210430_x_at","214464_at","206093_x_at","203662_s_at",
      "210586_x_at","209555_s_at","215449_at","202201_at","206283_s_at","221627_at",
      "206145_at","206077_at","205390_s_at","205391_x_at","208886_at","237403_at",
      "225061_at","216333_x_at","208353_x_at","213451_x_at","207087_x_at","209160_at","205262_at")
  
  testlogdata  <- t(testlogdata);
  trainlogdata <- t(trainlogdata);
  inters <- intersect(colnames(testlogdata), names(MullScore))
  if(length(inters)<length(MullScore)){
    warning("Not all mulligan genes in dataset!")
  }
  testlogdata <- testlogdata[,intersect(colnames(testlogdata),names(MullScore))]
  testlogdata <- meanvarstandardize(testdata=testlogdata,traindata=trainlogdata)
  score <- testlogdata %*% MullScore[colnames(testlogdata)]
  return(matrix(cbind(score,score>threshold),ncol=2,
                dimnames=list(rownames(testlogdata),c("score","isHighRisk"))))
}


IFM15Classifier <- function(testlogdata, trainlogdata, threshold = NULL){
  
  #Threshold according to article is at the highest quantile in the trainset. This must be +- 0.71
  if (is.null(threshold)){
    threshold=0.71
  }
  
  decauxScore <- 
    c(0.29483393,0.2491429,0.17822457,0.13137903,0.38697337,0.31490195,0.30371178,
      0.29530369,0.27578783,0.26987655,0.25043791,0.21956366,0.21255699,0.19243758,
      0.08886402,0.08886402)
  
  names(decauxScore) <- 
    c("209683_at","200779_at","203657_s_at","201425_at","217752_s_at","200783_s_at",
      "202486_at","202951_at","208644_at","202470_s_at","212098_at","228737_at",
      "204072_s_at","228677_s_at","1565162_s_at","231736_x_at")
  
  testlogdata<-t(testlogdata);
  trainlogdata<-t(trainlogdata);
  inters<-intersect(colnames(testlogdata),names(decauxScore))
  if(length(inters)<length(decauxScore)){
    warning("Not all IFM15 genes in dataset!")
  }
  testlogdata<-testlogdata[,intersect(colnames(testlogdata),names(decauxScore))]
  testlogdata<-meanvarstandardize(testdata=testlogdata,traindata=trainlogdata)
  
  score<-testlogdata%*%decauxScore[colnames(testlogdata)]
  return(matrix(cbind(score,score>threshold),ncol=2,
                dimnames=list(rownames(testlogdata),c("score","isHighRisk"))))
}

UAMS70Classifier <- function(testlogdata, threshold = NULL){
  
  #applied to non scaled/centred data (scaling/centring not mentioned in paper)
  if (is.null(threshold)){threshold=0.66}
  up <-
    c("202345_s_at","1555864_s_at","204033_at","206513_at","1555274_a_at","211576_s_at",
      "204016_at","1565951_s_at","219918_s_at","201947_s_at","213535_s_at","204092_s_at",
      "213607_x_at","208117_s_at","210334_x_at","204023_at","201897_s_at","216194_s_at",
      "225834_at","238952_x_at","200634_at","208931_s_at","206332_s_at","220789_s_at",
      "218947_s_at","213310_at","224523_s_at","201231_s_at","217901_at","226936_at",
      "58696_at","200916_at","201614_s_at","200966_x_at","225082_at","242488_at","243011_at",
      "201105_at","224200_s_at","222417_s_at","210460_s_at","200750_s_at","206364_at",
      "201091_s_at","203432_at","221970_s_at","212533_at","213194_at","244686_at",
      "200638_s_at","205235_s_at")
  down <- 
    c("201921_at","227278_at","209740_s_at","227547_at","225582_at","200850_s_at","213628_at",
      "209717_at","222495_at","1557277_a_at","1554736_at","218924_s_at","226954_at",
      "202838_at","230192_at","48106_at","237964_at","202729_s_at","212435_at")
  
  testlogdata<-t(testlogdata);
  intersup<-intersect(up,colnames(testlogdata))
  intersdown<-intersect(down,colnames(testlogdata))
  if( (length(intersup)!=length(up)) | (length(intersdown)!=length(down))){
    warning("Not all probes are in the data set")
  }
  data_up<-testlogdata[,intersup]
  data_down<-testlogdata[,intersdown]
  score<-log(2^rowMeans(data_up)/2^rowMeans(data_down),2)
  return(matrix(cbind(score,score > threshold),ncol=2,
                dimnames=list(rownames(testlogdata),c("score", "isHighRisk"))))
}


wrapperForArticle<-function(testset=c("H65","TT2","TT3","APEX","MRCIX"), classifier=c("EMC92","UAMS70","UAMS17","UAMS80","MRCIX6","MILLENNIUM100","IFM15"),path=NULL,threshold=NULL){
  if (is.null(path)){path=getwd()}
  
  ok<-try(load(file.path(path,"batchCorrectedData.R")),silent=TRUE)
  if(class(ok)=="try-error"){stop("Cannot find file 'batchCorrectedData.R'. Please change workdir (function setwd) to the directory containing this file or set the path argument of the wrapper function")}
  
  testset = match.arg(testset)
  classifier = match.arg(classifier)
  
  gepset="gepwoapex";batchset="batcheswoapex"
  if ((testset=="APEX") | (classifier=="MILLENNIUM100")){	gepset="gepall";batchset="batchesall"}
  
  testset<-batchCorrectedData[[gepset]][, batchCorrectedData[[batchset]][testset,]]
  
  if (classifier=="EMC92"){
    trainset<-batchCorrectedData[[gepset]][, batchCorrectedData[[batchset]]["H65",]]
    return(EMC92Classifier(trainlogdata=trainset,testlogdata=testset,threshold=threshold))
    
  }
  if (classifier=="MRCIX6"){
    return(MRCIX6Classifier(testlogdata=testset,threshold=threshold))
    
  }
  if (classifier=="UAMS80"){
    return(UAMS80Classifier(testlogdata=testset,threshold=threshold))
    
  }
  if (classifier=="UAMS17"){
    print("This wrapper function provides no predictions for the UAMS17 signature"); return("");
    trainset<-batchCorrectedData[[gepset]][, batchCorrectedData[[batchset]]["TT2",]]
    return(UAMS17Classifier(trainlogdata=trainset,testlogdata=testset,threshold=threshold))
    
  }
  if (classifier=="UAMS70"){
    return(UAMS70Classifier(testlogdata=testset,threshold=threshold))
    
  }
  if (classifier=="IFM15"){
    return(IFM15Classifier(trainlogdata=testset,testlogdata=testset,threshold=threshold))
    
  }
  if (classifier=="MILLENNIUM100"){
    trainset<-batchCorrectedData[[gepset]][, batchCorrectedData[[batchset]]["APEX",]]
    
    return(MILLENNIUM100Classifier(trainlogdata=trainset,testlogdata=testset,threshold=threshold))
    
  }
}

